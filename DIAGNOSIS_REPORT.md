# 후기 표시 문제 진단 및 해결 보고서

**작성일**: 2025-12-28
**브랜치**: `claude/fix-review-display-UhTCJ`

## 📋 문제 요약

사용자가 보고한 2가지 이슈:

1. **1대1컨설팅 후기가 표시되지 않음** (Notion DB에는 3개 존재)
2. **4점 이하 후기가 표시되지 않음** (Notion DB에 3-4점 후기 존재)

## 🔍 진단 결과

### 현재 상태 (2025-12-28 12:24 기준)

```
총 후기: 100개
카테고리 분포:
  - consulting: 2개  ⚠️ (3개 중 1개 누락)
  - bootcamp: 98개

평점 분포:
  - 5점: 100개  ⚠️ (모두 5점으로 표시됨)
```

### 문제 1: 컨설팅 후기 누락 (2/3개만 표시)

**원인**: 3번째 컨설팅 후기의 "후기 내용" 필드가 비어있음

**근거**:
- 워크플로우 코드 `.github/workflows/update-notion-data.yml` 라인 495-508:
  ```javascript
  if (content) {
    reviews.push({...});  // 내용이 있을 때만 추가
  } else {
    console.log('✗ 후기 제외 (내용 없음)');  // 내용 없으면 제외
  }
  ```

**해결 방법**:
- ✅ Notion DB에서 3번째 컨설팅 후기의 "후기 내용" 필드에 실제 후기 내용 입력
- ✅ 워크플로우 로깅 개선 완료 (어떤 후기가 왜 제외되는지 명확히 표시)

### 문제 2: 모든 후기가 5점으로 표시됨

**원인**: Notion "별점" 필드의 Select 옵션 값이 `parseInt()`로 파싱되지 않음

**추정 시나리오**:
```javascript
// 기존 코드
const ratingStr = props[field].select.name;
rating = parseInt(ratingStr) || 5;  // 파싱 실패 시 기본값 5

// Notion의 "별점" 필드 값이 다음과 같은 경우 파싱 실패:
// ❌ "★★★★" → parseInt() = NaN → 기본값 5
// ❌ "매우만족" → parseInt() = NaN → 기본값 5
// ❌ "Very Good" → parseInt() = NaN → 기본값 5
// ✅ "4점" → parseInt() = 4 (성공)
// ✅ "4" → parseInt() = 4 (성공)
```

**해결 방법**:
✅ **워크플로우 개선 완료** - 다음 포맷 모두 지원:
1. 순수 숫자: "5", "4", "3", "2", "1"
2. 한글 포맷: "5점", "4점", "3점", "2점", "1점"
3. 별 기호: "★★★★★", "★★★★", "⭐⭐⭐"
4. 한글 만족도:
   - "매우만족" / "최고" → 5점
   - "만족" / "좋음" → 4점
   - "보통" / "괜찮음" → 3점
   - "불만족" / "아쉬움" → 2점
   - "매우불만족" → 1점

## 🔧 적용된 개선사항

### 1. 별점 파싱 함수 강화

새로운 `parseRating()` 함수 추가:
- **디버깅**: Notion의 실제 값을 로그에 출력 (`🔍 원본 값: "..."`)
- **다중 포맷**: 숫자, N점, 별 기호, 한글 만족도 모두 지원
- **명확한 피드백**: 파싱 성공/실패 메시지 출력

### 2. 후기 제외 로깅 개선

```javascript
console.log('✗ 후기 제외 (내용 없음): ID=' + review.id +
            ', 카테고리=' + category +
            ', 작성자=' + (author || '(없음)') +
            ', 별점=' + rating);
console.log('  ℹ️  "후기 내용" 필드를 확인하세요.');
```

### 3. 통계 분석 추가

워크플로우 실행 시 자동으로 다음 통계 출력:
- 카테고리별 분포
- 평점별 분포
- 1대1컨설팅 개수
- 4점 이하 개수
- 문제 발견 시 자동 경고

## 📝 다음 단계 (사용자 액션 필요)

### 단계 1: GitHub Actions 실행

1. GitHub 리포지토리 방문
2. **Actions** 탭 → **Update Notion Data** 워크플로우
3. **Run workflow** 버튼 클릭하여 수동 실행

### 단계 2: 로그 확인

워크플로우 실행 후 로그에서 다음 정보 확인:

```
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 후기 데이터 통계
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

후기 #1 처리 중...
  → 별점 필드 발견 (select): 별점
    🔍 원본 값: "4점"        ← 이 부분 확인!
    ✓ "N점" 파싱 성공: 4
  → 최종 별점: 4

카테고리별 분포:
  - consulting: X개
  - bootcamp: Y개

평점별 분포:
  - 5점: A개
  - 4점: B개              ← 0이 아닌 숫자가 나와야 함!
  - 3점: C개
```

### 단계 3: Notion DB 확인사항

#### 별점 필드

1. Notion DB에서 "별점" 필드의 Select 옵션 확인
2. 로그에서 `🔍 원본 값` 메시지 찾기
3. 만약 워크플로우가 지원하지 않는 포맷이면 알려주세요

**예시**:
- ✅ 지원됨: "5", "4점", "★★★★", "매우만족"
- ❌ 미지원: "Excellent", "Good", "Fair" (영문 만족도)

#### 후기 내용 필드

1. 1대1컨설팅 후기 3개 모두 "후기 내용" 필드에 텍스트 입력되어 있는지 확인
2. 로그에서 `✗ 후기 제외 (내용 없음)` 메시지가 있는지 확인
3. 컨설팅 후기인데 제외된 것이 있다면 해당 후기의 "후기 내용" 채우기

### 단계 4: 결과 검증

워크플로우 실행 후:

```bash
# 로컬에서 진단 스크립트 실행
bash quick-diagnosis.sh
```

**기대 결과**:
```
✅ 컨설팅 후기: 3 개
✅ 4점 이하 후기: N 개  (N > 0)
```

## 🎯 성공 기준

다음 조건이 모두 충족되면 문제 해결:

- [ ] 1대1컨설팅 후기가 3개 표시됨
- [ ] 4점 이하 후기가 실제 개수만큼 표시됨
- [ ] `data/reviews.json`의 평점 분포가 Notion DB와 일치함
- [ ] 웹사이트에서 다양한 별점의 후기가 보임

## 🔧 문제 발생 시 체크리스트

### 여전히 4점 이하 후기가 안 보이는 경우

1. GitHub Actions 로그에서 `🔍 원본 값` 찾기
2. 해당 값이 무엇인지 확인
3. 만약 특이한 포맷이면 별도 지원 필요

### 여전히 컨설팅 후기가 2개만 보이는 경우

1. GitHub Actions 로그에서 `✗ 후기 제외 (내용 없음)` 찾기
2. 제외된 후기 중 `카테고리=consulting`인 것 확인
3. 해당 후기 ID로 Notion에서 찾아서 "후기 내용" 필드 채우기

## 📞 추가 지원 필요 시

다음 정보를 제공해 주세요:

1. GitHub Actions 로그 전체 또는 관련 부분
2. Notion "별점" 필드의 실제 Select 옵션 목록 (스크린샷 또는 텍스트)
3. `quick-diagnosis.sh` 실행 결과
4. 특정 후기의 ID (문제가 있는 경우)

---

**변경사항 커밋**: `87d54f8` - 별점 추출 로직 개선 및 진단 강화
**브랜치**: `claude/fix-review-display-UhTCJ`
